@{
    ViewBag.Title = "AskforList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div>
    <div class="top功能 d-flex justify-content-between align-items-center mb-3">
        <a class="btn btn-primary" id="新增button" href="/DDDDD/Askfor">新增假單</a>
        <div class="ui mini icon input" id="SearchList">
            <input type="text" placeholder="Search mini...">
            <i class="search icon"></i>
        </div>
    </div>
</div>




<div class="ui pointing secondary menu">
    <a class="active item" data-tab="first">請假</a>
    <a class="item" data-tab="second">加班</a>
    <a class="item" data-tab="third">出差</a>
</div>
<div class="ui active tab segment" data-tab="first">
    <div class="ui top attached tabular menu">
        <a class="active item" data-tab="first/a">請假申請</a>
        <a class="item" data-tab="first/b">未審核總表</a>
        <a class="item" data-tab="first/c">已審核總表</a>
    </div>
    <div class="ui bottom attached active tab segment" data-tab="first/a">
        <div class="head">
            <h2 class="h2共用">請假(新增)</h2>
            <form name="form2" class="form1">
                <div class="d-flex flex-wrap justify-content-center pt-3">
                    @*d-flex + flex-wrap or row*@
                    @*<div>
                            <label>申請表編號</label>
                            <input type="text" id="申請表編號" class="w-100" name="申請表編號" hidden/>
                        </div>*@
                    <div class="mb-4 col-12 col-md-4">
                        <label>員工編號:</label>
                        <label></label>
                        <input type="text" id="請假EmployeeID" class="w-100" name="EmployeeID" />
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>員工姓名:</label>
                        <label></label>
                        <input type="text" id="請假中文姓名" class="w-100" name="中文姓名" />
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>職稱:</label>
                        <label></label>
                        <input type="text" id="請假jobtitle" class="w-100" name="職稱" />
                    </div>
                </div>
                <div class="d-flex flex-wrap justify-content-center">
                    <div class="mb-4 col-12 col-md-4">
                        <label>信箱:</label>
                        <label></label>
                        <input type="text" id="請假Email" class="w-100" name="信箱" />
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>部門:</label>
                        <label></label>
                        <input type="text" id="請假department" class="w-100" name="部門" />
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>請假班別:</label>
                        <label></label>
                        <input type="text" id="請假班別2" class="w-100" name="請假班別" required />
                    </div>
                </div>
                <div class="d-flex flex-wrap justify-content-center">
                    <div class="mb-4 col-12 col-md-4">
                        <label>開始日期:</label>
                        <input type="datetime-local" id="請假startday" class="w-100" name="開始日期" required>
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>結束日期:</label>
                        <input type="datetime-local" id="請假endday" class="w-100" name="結束日期" required>
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>申請日期:</label>
                        <input type="datetime-local" id="請假applicationday" class="w-100" name="申請日期" required>
                    </div>
                </div>
                <div class="d-flex flex-wrap justify-content-center">
                    <div class="mb-4 col-12 col-md-4">
                        <label>請假時數:</label>
                        <label></label>
                        <input type="text" id="請假askfortime" class="w-100 請假時數" name="請假時數">
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>代理人:</label>
                        <input type="text" id="請假agent" class="w-100" name="代理人" required>
                    </div>
                    <div class="mb-4 col-12 col-md-4">
                        <label>已用可用:</label>
                        <input type="text" id="請假已用可用" class="w-100" name="已用可用" required />
                    </div>
                </div>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <div class="mb-4 col-12 col-md-4">
                        <label>請假類別:</label>
                        <select id="請假select1" class="w-100" name="假別ID" required>
                            <option value="0">請選擇</option>
                            <option value="1">事假</option>
                            <option value="2">病假</option>
                            <option value="3">生理假</option>
                            <option value="4">喪假</option>
                            <option value="5">婚假</option>
                            <option value="6">公假</option>
                            <option value="7">產假</option>
                            <option value="8">陪產假</option>
                            <option value="9">防疫隔離假</option>
                            <option value="10">特休</option>
                            <option value="11">加班補修</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <input type="file" name="圖片" id="upload" multiple />
                        <input type="reset" class="resetform" hidden />
                    </div>
                    <input type="text" id="審核狀態" class="w-100" name="審核狀態" value="未審核" hidden />
                </div>
                <div class="form-group d-flex justify-content-center">
                    <a class="btn btn-primary" id="button送出" onclick="AddEmp()">送出</a>
                    <a class="btn btn-secondary" id="buttonDemo" onclick="Demo()">DEMO</a>
                </div>
            </form>

        </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="first/b">
        <table class="table-hover w-100 table table-striped text-nowrap">
            <thead id="head總表">
            </thead>
            <tbody id="AskForListTbody">
            </tbody>
        </table>
    </div>
    <div class="ui bottom attached tab segment" data-tab="first/c">

    </div>
</div>
@*======================================加班申請=======================================*@
<div class="ui tab segment" data-tab="second">
    <div class="ui top attached tabular menu">
        <a class="item" data-tab="second/a">加班申請</a>
        <a class="item" data-tab="second/b">加班未審核總表</a>
        <a class="item" data-tab="second/c">加班已審核總表</a>
    </div>
    <div class="ui bottom attached tab segment" data-tab="second/a">
        <div class="head">
            <form class="leftbody">
                <h2 class="h2共用">加班單</h2>
                <div class="d-flex justify-content-center flex-wrap">
                    @*<div class="mb-4 col-12 col-md-4">
                            <label>加班表編號:</label>
                            <input type="text" id="加班表編號" class="w-100">
                        </div>*@
                    <div class="col-md-6 加班單內容左">
                        <div class="mb-4 員工編號">
                            <label>員工編號:</label><br />
                            <input type="text" class="w-75" id="加班EmployeeID">
                        </div>
                        <div class="mb-4 中文姓名">
                            <label>中文姓名:</label><br />
                            <input type="text" class="w-75" id="加班中文姓名">
                        </div>
                        <div class="mb-4 部門">
                            <label>部&emsp;&emsp;門:</label><br />
                            <input type="text" class="w-75 " id="加班department">
                        </div>
                        <div class="mb-4 test 開始日期">
                            <label>開始日期:</label><br />
                            <input type="datetime-local" id="加班startday" class="w-75" required>
                        </div>
                        <div class="mb-4 test1 結束日期">
                            <label>結束日期:</label><br />
                            <input type="datetime-local" id="加班endday" class="w-75" required>
                        </div>
                    </div>
                    <div class="bodyright col-md-6 加班單內容左">
                        <div class="mb-3">
                            <label>事由說明:</label><br />
                            <textarea id="加班事由說明" class="w-75" rows="8" name="TxtMemo" cols="18" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label>加班類別:</label>
                            <div class="mr-3 加班類別" id="加班ID2" required>
                                <input type="radio" name="加班類別" value="1" />&ensp;延長加班
                                <input type="radio" name="加班類別" value="2" class="ml-3" />&ensp;例假日加班<br />
                                <input type="radio" name="加班類別" value="3" />&ensp;休息日加班
                                <input type="radio" name="加班類別" value="4" />&ensp;國定假日加班
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="mb-4 加班時數">
                                <label>加班時數:</label><br />
                                <input type="text" class="w-75" id="加班時數2" disabled>
                            </div>
                        </div>
                        <input type="text" name="審核狀態" id="加班審核狀態" value="未審核" hidden>
                    </div>
                </div>
                <div class="form-group d-flex justify-content-center">
                    <a class="btn btn-primary 加班送出" onclick="AddOverTime()">送出</a>
                    <a class="btn btn-secondary" id="buttonDemo" onclick="加班Demo()">DEMO</a>
                </div>
            </form>
        </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="second/b">
        <table class="table-hover w-100 table table-striped text-nowrap">
            <thead id="head加班">
            </thead>
            <tbody id="OverTimeListTbody">
            </tbody>
        </table>
    </div>
    <div class="ui bottom attached tab segment" data-tab="second/c">

    </div>
</div>
@*======================================出差申請=======================================*@
<div class="ui tab segment" data-tab="third">
    <div class="ui top attached tabular menu">
        <a class="item" data-tab="third/a">出差申請</a>
        <a class="item" data-tab="third/b">出差未審核總表</a>
        <a class="item" data-tab="third/c">出差已審核總表</a>
    </div>
    <div class="ui bottom attached tab segment" data-tab="third/a">
        <div class="head">
            <div class="ui form">
                <h2 class="h2共用">出差單</h2>
                <div class="three fields">
                    <div class="field">
                        <label>員工編號:</label>
                        <input type="text" id="出差EmployeeID" name="EmployeeID">
                    </div>
                    <div class="field">
                        <label>申請人:</label>
                        <input type="text" id="出差中文姓名" name="中文姓名">
                    </div>
                    <div class="field">
                        <label>部&emsp;&emsp;門:</label>
                        <input type="text" id="出差部門" name="部門">
                    </div>
                </div>
                <div class="three fields">
                    <div class="field">
                        <label>出差類型:</label>
                        <select class="ui fluid dropdown" id="出差出差類型" name="出差類型" required>
                            <option value="">請選擇</option>
                            <option value="國內">國內</option>
                            <option value="國外">國外</option>
                        </select>
                    </div>
                    <div class="field">
                        <label>交通需求:</label>
                        <div class="field">
                            <select class="ui fluid dropdown" id="出差交通需求" name="交通需求" required>
                                <option value="請選擇">請選擇</option>
                                <option value="火車票">火車票</option>
                                <option value="高鐵票">高鐵票</option>
                                <option value="飛機票">飛機票</option>
                                <option value="自行安排">自行安排</option>
                            </select>
                        </div>
                    </div>
                    <div class="field">
                        <label>住宿需求:</label>
                        <select class="ui fluid dropdown" id="出差住宿需求" name="住宿需求" required>
                            <option value="請選擇">請選擇</option>
                            <option value="國內住宿">國內住宿</option>
                            <option value="國外住宿">國外住宿</option>
                            <option value="自行安排">自行安排</option>
                        </select>
                    </div>
                </div>
                <div class="four fields">
                    <div class="field">
                        <label>開始日期:</label>
                        <input type="datetime-local" id="出差開始日期" name="開始日期" required>
                    </div>
                    <div class="field">
                        <label>結束日期:</label>
                        <input type="datetime-local" id="出差結束日期" name="結束日期" required>
                    </div>
                    <div class="field">
                        <label>預支費用:</label>
                        <input type="text" name="預支費用" id="出差預支費用" required>
                    </div>

                    <div class="field">
                        <label>出差地點:</label>
                        <input type="text" name="出差地點" id="出差出差地點" required>
                    </div>
                </div>
                <div class="field">
                    <label>備註:</label>
                    <textarea id="出差備註" style="resize:none"></textarea>
                </div>
            </div>
            <input type="text" name="審核狀態" id="出差審核狀態" value="未審核" hidden>
            <div class="form-group d-flex justify-content-center mt-3">
                <a class="btn btn-primary" onclick="AddBusinessTripAjax()">送出</a>
                <a class="btn btn-secondary" id="buttonDemo" onclick="出差Demo()">DEMO</a>
            </div>
        </div>
    </div>
    <div class="ui bottom attached tab segment" data-tab="third/b">
        <table class="table-hover w-100 table table-striped text-nowrap">
            <thead id="head">
            </thead>
            <tbody id="BusinessTripListTbody">
            </tbody>
        </table>
    </div>
    <div class="ui bottom attached tab segment" data-tab="third/c">

    </div>
</div>































@*<div class="ui pointing secondary menu">
        <a class="item" data-tab="first">請假</a>
        <a class="item active" data-tab="second">加班</a>
        <a class="item" data-tab="third">出差</a>
    </div>
    <div class="ui tab segment" data-tab="first">
        <div class="ui top attached tabular menu">
            <a class="active item" data-tab="first/a">請假總表</a>
            <a class="item" data-tab="first/b">請假申請</a>
        </div>
        <div class="ui bottom attached active tab segment" data-tab="first/a">
            <table class="table-hover w-100 table table-striped text-nowrap">
                <thead id="head總表">
                </thead>
                <tbody id="AskForListTbody">
                </tbody>
            </table>
        </div>
        <div class="ui bottom attached tab segment" data-tab="first/b">

        </div>
    </div>



    <div class="ui tab segment active" data-tab="second">
        <div class="ui top attached tabular menu">
            <a class="item active" data-tab="second/a">加班總表</a>
            <a class="item" data-tab="second/b">加班申請</a>
        </div>
        <div class="ui bottom attached tab segment active" data-tab="second/a">

        </div>
        <div class="ui bottom attached tab segment" data-tab="second/b">

        </div>
    </div>



    <div class="ui tab segment" data-tab="third">
        <div class="ui top attached tabular menu">
            <a class="item" data-tab="third/a">出差總表</a>
            <a class="item" data-tab="third/b">出差申請</a>
        </div>
        <div class="ui bottom attached tab segment" data-tab="third/a">

        </div>
        <div class="ui bottom attached tab segment" data-tab="third/b">

        </div>
    </div>*@

@*======================================請假彈出=======================================*@

<div class="ui modal centermodal" id="請假彈出">
    <div class="header">Header</div>
    <div class="content">
        @*Start*@
        <div>
            <h2 class="mb-5">請假(修改)</h2>
            <form>
                <div>
                    <label>員工編號:</label>
                    <label></label>
                    <input type="text" id="EmployeeID" disabled />
                </div>
                <div>
                    <label>員工姓名:</label>
                    <label></label>
                    <input type="text" id="中文姓名" disabled />
                </div>
                <div>
                    <label>職稱:</label>
                    <label></label>
                    <input type="text" id="jobtitle" disabled />
                </div>
                <div>
                    <label>信箱:</label>
                    <label></label>
                    <input type="text" id="Email" disabled />
                </div>
                <div>
                    <label>部門:</label>
                    <label></label>
                    <input type="text" id="department" disabled />
                </div>
                <div>
                    <label>請假班別:</label>
                    <label></label>
                    <input type="text" id="請假班別" />
                </div>
                <div>
                    <label>請假類別:</label>
                    <select id="select1">
                        <option value="0">請選擇</option>
                        <option value="1">事假</option>
                        <option value="2">病假</option>
                        <option value="3">生理假</option>
                        <option value="4">喪假</option>
                        <option value="5">婚假</option>
                        <option value="6">公假</option>
                        <option value="7">產假</option>
                        <option value="8">陪產假</option>
                        <option value="9">防疫隔離假</option>
                        <option value="10">特休</option>
                        <option value="11">加班補修</option>
                    </select>
                </div>
                <div>
                    <label>開始日期</label>
                    <input type="datetime-local" id="startday">
                </div>
                <div>
                    <label>結束日期</label>
                    <input type="datetime-local" id="endday">
                </div>
                <div>
                    <label>申請日期</label>
                    <input type="datetime-local" id="applicationday">
                </div>
                <div>
                    <label>請假時數</label>
                    <input type="text" id="askfortime">
                </div>
                <div>
                    <label>代理人</label>
                    <input type="text" id="agent">
                </div>
                <div>
                    <label>審核狀態</label>
                    <label></label>
                    <input type="text" id="approvalStatus" disabled />
                </div>
                <div class="mt-3">
                    <img src="" class="showPic" style="width:400px;" />
                </div>
            </form>
        </div>
    </div> @*End*@
    <div class="actions">
        <div class="ui approve button" onclick="Update請假()">確認修改</div>
        <div class="ui cancel button">取消</div>
    </div>
</div>

@*======================================加班彈出=======================================*@

<div class="ui small modal centermodal" id="加班彈出">
    <i class="close icon"></i>
    @*Start*@
    <div class="head">
        <h2>加班單(修改)</h2>
        <form>
            <div>
                <div>
                    <label>員工編號:</label>
                    <input type="text" class="w-100" id="加班總表EmployeeID" disabled>
                </div>
                <div>
                    <label>中文姓名:</label>
                    <input type="text" class="w-100" id="加班總表中文姓名" disabled>
                </div>
                <div>
                    <label>部&emsp;&emsp;門:</label>
                    <input type="text" class="w-100" id="加班總表department" disabled>
                </div>
            </div>
            <div>
                <div>
                    <label>開始日期:</label>
                    <input type="datetime-local" id="加班總表startday" class="w-100" disabled>
                </div>
                <div>
                    <label>結束日期:</label>
                    <input type="datetime-local" id="加班總表endday" class="w-100" disabled>
                </div>
                <div>
                    <label>加班時數:</label>
                    <input type="text" class="w-100" id="加班總表加班時數" disabled>
                </div>
            </div>
            <div>
                <div>
                    <label>加班類別:</label>
                    <div class="mr-3" id="加班總表加班ID">
                        <input type="radio" name="加班類別" value="1" disabled />&ensp;延長加班
                        <input type="radio" name="加班類別" value="2" disabled />&ensp;例假日加班<br />
                        <input type="radio" name="加班類別" value="3" disabled />&ensp;休息日加班
                        <input type="radio" name="加班類別" value="4" disabled />&ensp;國定假日加班
                    </div>
                </div>
                <div>
                    <label>事由說明:</label><br />
                    <textarea id="加班總表事由說明" style="resize:none" class="w-100" disabled></textarea>
                </div>
                <div>
                    <label>審核狀態</label>
                    <label></label>
                    <input type="text" id="加班approvalStatus" disabled />
                </div>
            </div>
            <div class="modal-footer 加班1 row justify-content-center actions">
                <button type="button" class="btn btn-primary" onclick="Update()">確認修改</button>
                <button type="button" class="btn btn-danger cancel">取消</button>
            </div>
        </form>
    </div> @*End*@
</div>


@*==========================================出差彈出==================================================*@

<div class="ui small modal centermodal" id="出差彈出">
    <i class="close icon"></i>
    @*Start*@
    <div class="head">
        <form>
            <h2 class="h2共用">出差單</h2>
            <div>
                <div class="mb-4 員工編號">
                    <label>員工編號:</label><br />
                    <input type="text" class="w-75" id="出差總表EmployeeID" disabled>
                </div>
                <div class="mb-4 申請人">
                    <label>申請人:</label><br />
                    <input type="text" class="w-75" id="出差總表中文姓名" disabled>
                </div>
                <div class="mb-4 部門">
                    <label>部&emsp;&emsp;門:</label><br />
                    <input type="text" class="w-75 " id="出差總表部門" disabled>
                </div>
                <div class="mb-4">
                    <label>出差類型:</label><br />
                    <select id="出差總表出差類型" class="w-75" disabled>
                        <option value="請選擇">請選擇</option>
                        <option value="國內">國內</option>
                        <option value="國外">國外</option>
                    </select>
                </div>
            </div>
            <div>
                <div class="mb-4 出差地點">
                    <label>出差地點:</label><br />
                    <input type="text" class="w-75" id="出差總表出差地點" disabled>
                </div>
                <div class="mb-4 test 開始日期">
                    <label>開始日期:</label><br />
                    <input type="datetime-local" id="出差總表開始日期" class="w-75" disabled>
                </div>
                <div class="mb-4 test1 結束日期">
                    <label>結束日期:</label><br />
                    <input type="datetime-local" id="出差總表結束日期" class="w-75" disabled>
                </div>
            </div>
            <div>
                <div class="mb-4">
                    <label>交通需求:</label><br />
                    <select id="出差總表交通需求" class="w-75" disabled>
                        <option value="請選擇">請選擇</option>
                        <option value="火車票">火車票</option>
                        <option value="高鐵票">高鐵票</option>
                        <option value="飛機票">飛機票</option>
                        <option value="自行安排">自行安排</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label>住宿需求:</label><br />
                    <select id="出差總表住宿需求" class="w-75" disabled>
                        <option value="請選擇">請選擇</option>
                        <option value="國內住宿">國內住宿</option>
                        <option value="國外住宿">國外住宿</option>
                        <option value="自行安排">自行安排</option>
                    </select>
                </div>
                <div class="mb-4 預支費用">
                    <label>預支費用:</label><br />
                    <input type="number" class="w-75" id="出差總表預支費用" min="1000" disabled>
                </div>
                <div class="mb-3">
                    <label>備註:</label><br />
                    <textarea id="出差總表備註" class="w-75" disabled></textarea>
                </div>
                <div>
                    <label>審核狀態</label><br />
                    <select id="出差approvalStatus" class="w-75">
                        <option value="未審核">未審核</option>
                        <option value="已審核">已審核</option>
                    </select>
                </div>
            </div>
            <div class="form-group d-flex justify-content-center actions">
                <a class="btn btn-primary" onclick="UpdateBusiness()">送出</a>
                <button type="button" class="btn btn-danger cancel">取消</button>
            </div>
        </form>
    </div> @*End*@
</div>


@section script{
    <script>

        $('.menu .item').tab();



        function modelshow() {
            $('#請假彈出').modal('toggle');
        }


        //==================================請假部分=========================================================================================

        let start;
        let end;
        //=============================新增=======================================


        $("#請假endday, #請假startday").blur(function () {
            if ($("#請假startday").val() != '' && $("#請假endday").val() != '') {
                start = new Date($("#請假startday").val());
                end = new Date($("#請假endday").val());
                var offset = new Date($("#請假endday").val()).getTime() - new Date($("#請假startday").val()).getTime();
                var swag = Math.floor(Math.abs(offset / 1000 / 60 / 60 / 24 - 1));
                console.log(swag);
                let x = Math.floor(swag);
                let 開始小時數 = 17 - start.getHours();
                let 結束小時數 = end.getHours() - 9;
                if (x + 1 < 0) {
                    window.alert("請輸入正確日期");
                }
                else if (start.getDate() === end.getDate()) {
                    $(".請假時數").val(`${end.getHours() - start.getHours()} `)
                }
                else {
                    $(".請假時數").val(`${開始小時數 + swag * 9 + 結束小時數} `)
                }
            }
        });




        function AddEmp() {
            console.log($(document.form2).find('[name]')[0].value);
            console.log($("#upload").get(0).files[0].name);
            var formData = new FormData(document.form2);
            formData.append('upPhoto', $("#upload").get(0).files[0]);
            $.ajax({
                url: "/DDDDD/AskForAjax1",
                type: "POST",
                contentType: false,
                processData: false,
                data: formData,
                success: function (result) {
                    if (result == "ok") {
                        setTimeout(function () {
                            //window.location.href = "/DDDDD/AskforList";
                            $("[data-tab='first/b']").not(".tab").click();
                            ReFresh();
                        }, 2000);
                        swal("成功", "新增成功", "success");
                        $(".resetform").click();
                    }
                }
            })
        }


        function Demo() {
            $("#請假EmployeeID").val("1"),
                $("#請假中文姓名").val("胡冠安"),
                $("#請假jobtitle").val("員工"),
                $("#請假Email").val("abc@gmail.com"),
                $("#請假department").val("資訊部"),
                $("#請假班別2").val("早班"),
                $("#請假startday").val("2021-03-23T09:00:00"),
                $("#請假endday").val("2021-03-23T17:00:00"),
                $("#請假applicationday").val("2021-03-23T09:00:00"),
                $("#請假agent").val("Yuan"),
                $("#請假askfortime").val("8"),
                $("#審核狀態").val("未審核"),
                $("#請假select1").val(1),
                $("#請假已用可用").val("10")
        };


        //======================================= 總表顯示 =======================================
        $(function () {
            getAskForList();
        })
        function getAskForList() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/AskforListAjax",
                    type: "GET",
                    success: function (memberlist) {
                        $("#head總表").append(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>職稱</th>
                                                        <th>部門</th>
                                                        <th>請假班別</th>
                                                        <th>假別</th>
                                                        <th>申請日期</th>
                                                        <th>請假時數</th>
                                                        <th>代理人</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                    </tr>`
                        );
                        $(memberlist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);
                            var 申請日期 = parseInt(item.申請日期.replace(/\D/igm, ""));
                            var testtime3 = new Date(申請日期);

                            if (testtime3.getHours() < 10) {
                                h3 = "0" + testtime3.getHours();
                            } else {
                                h3 = testtime3.getHours();
                            }
                            if (testtime3.getMinutes() < 10) {
                                var a3 = "0" + testtime3.getMinutes()
                            } else {
                                a3 = testtime3.getMinutes();
                            }
                            $("#AskForListTbody").append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.職稱}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${item.請假班別}</td>
                                                            <td>${item.假別1}</td>
                                                            <td>${testtime3.getFullYear() + "/" + (testtime3.getMonth() + 1) + "/" + testtime3.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.請假時數}</td>
                                                            <td>${item.代理人}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-id ="${item.申請表編號}" data-target="#請假彈出" onclick="UpdateGetData請假(),modelshow()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="Fdelete()" data-id="${item.申請表編號}"><span>刪除</span></a></td>
                                                        </tr>`
                            );
                        })
                    },
                });
            }
            else {
                $.ajax({
                    url: "/DDDDD/AskforListAjax",
                    type: "GET",
                    success: function (memberlist) {
                        $("#head總表").append(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>職稱</th>
                                                        <th>部門</th>
                                                        <th>請假班別</th>
                                                        <th>假別</th>
                                                        <th>申請日期</th>
                                                        <th>請假時數</th>
                                                        <th>代理人</th>
                                                        <th>審核狀態</th>
                                                    </tr>`
                        );
                        $(memberlist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);
                            var 申請日期 = parseInt(item.申請日期.replace(/\D/igm, ""));
                            var testtime3 = new Date(申請日期);

                            if (testtime3.getHours() < 10) {
                                h3 = "0" + testtime3.getHours();
                            } else {
                                h3 = testtime3.getHours();
                            }
                            if (testtime3.getMinutes() < 10) {
                                var a3 = "0" + testtime3.getMinutes()
                            } else {
                                a3 = testtime3.getMinutes();
                            }
                            $("#AskForListTbody").append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.職稱}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${item.請假班別}</td>
                                                            <td>${item.假別1}</td>
                                                            <td>${testtime3.getFullYear() + "/" + (testtime3.getMonth() + 1) + "/" + testtime3.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.請假時數}</td>
                                                            <td>${item.代理人}</td>
                                                            <td>${item.審核狀態}</td>
                                                        </tr>`
                            );
                        })
                    },
                });
            }
        };




        //======================================= 修改 =======================================

        let getID;

        function Update請假() {
            if (true) {
                $.ajax({
                    url: "/DDDDD/UpdateDataAjax",
                    type: "POST",
                    data: {
                        "申請表編號": getID,
                        "EmployeeID": $("#EmployeeID").val(),
                        "中文姓名": $("#中文姓名").val(),
                        "職稱": $("#jobtitle").val(),
                        "信箱": $("#Email").val(),
                        "部門": $("#department").val(),
                        "請假班別": $("#請假班別").val(),
                        "假別ID": $("#select1").val(),
                        "開始日期": $("#startday").val(),
                        "結束日期": $("#endday").val(),
                        "申請日期": $("#applicationday").val(),
                        "請假時數": $("#askfortime").val(),
                        "代理人": $("#agent").val(),
                        "審核狀態": $("#approvalStatus").val()
                    },
                    success: function (result) {
                        if (result != 0) {
                            $('#請假彈出').modal('toggle');
                            swal("成功", "修改成功", "success");
                            ReFresh();
                        }
                    }
                })
            }
        }

        function UpdateGetData請假() {
            console.log($(event.currentTarget).data("id"));
            console.log($(event.currentTarget));
            getID = $(event.currentTarget).data("id");
            $.ajax({
                url: "/DDDDD/GetUpdateData",
                type: "GET",
                data: { "id": $(event.currentTarget).data("id") },
                success: function (getdata) {

                    console.log(getdata.圖片);
                    console.log(getdata);
                    var testtime = parseInt(getdata.開始日期.replace(/\D/igm, ""));
                    var testtime1 = new Date(testtime);
                    var 結束日期 = parseInt(getdata.結束日期.replace(/\D/igm, ""));
                    var testtime2 = new Date(結束日期);
                    var 申請日期 = parseInt(getdata.申請日期.replace(/\D/igm, ""));
                    var testtime3 = new Date(申請日期);
                    console.log(testtime1);
                    if ((testtime1.getMonth() + 1) < 10) //月
                    {
                        var a = "0" + (testtime1.getMonth() + 1);  //why var
                    }
                    else {
                        a = (testtime1.getMonth() + 1);
                    }
                    if ((testtime2.getMonth() + 1) < 10) {
                        var gg2 = "0" + (testtime2.getMonth() + 1);
                    }
                    else {
                        gg2 = (testtime2.getMonth() + 1);
                    }
                    if ((testtime3.getMonth() + 1) < 10) {
                        var kk3 = "0" + (testtime3.getMonth() + 1);
                    }
                    else {
                        kk3 = (testtime3.getMonth() + 1);
                    }
                    if (testtime1.getDate() < 10) //日
                    {
                        var rr1 = "0" + (testtime1.getDate());
                    }
                    else {
                        rr1 = testtime1.getDate();
                    }
                    if (testtime2.getDate() < 10) {
                        var aa2 = "0" + (testtime2.getDate());
                    }
                    else {
                        aa2 = testtime2.getDate();
                    }
                    if (testtime3.getDate() < 10) {
                        var bb3 = "0" + (testtime3.getDate());
                    }
                    else {
                        bb3 = testtime3.getDate();
                    }
                    if (testtime1.getHours() < 10) //時
                    {
                        var cc1 = "0" + testtime1.getHours();
                    }
                    else {
                        cc1 = testtime1.getHours();
                    }
                    if (testtime2.getHours() < 10) {
                        var dd2 = "0" + testtime2.getHours();
                    }
                    else {
                        dd2 = testtime2.getHours();
                    }
                    if (testtime3.getHours() < 10) {
                        var ee3 = "0" + (testtime3.getHours());
                    }
                    else {
                        ee3 = testtime3.getHours();
                    }
                    if (testtime1.getMinutes() < 10)  //分
                    {
                        var ff1 = "0" + testtime1.getMinutes();
                    }
                    else {
                        ff1 = testtime1.getMinutes();
                    }
                    if (testtime1.getMinutes() < 10) {
                        var mm2 = "0" + testtime1.getMinutes();
                    }
                    else {
                        mm2 = testtime1.getMinutes();
                    }
                    if (testtime1.getMinutes() < 10) {
                        var ll3 = "0" + testtime1.getMinutes();
                    }
                    else {
                        ll3 = testtime1.getMinutes();
                    }
                    $("#申請表編號").val(getdata.申請表編號);
                    $("#EmployeeID").val(getdata.EmployeeID);
                    $("#中文姓名").val(getdata.中文姓名);
                    $("#jobtitle").val(getdata.職稱);
                    $("#Email").val(getdata.信箱);
                    $("#department").val(getdata.部門);
                    $("#請假班別").val(getdata.請假班別);
                    $("#select1").val(getdata.假別ID);
                    $("#startday").val(testtime1.getFullYear() + "-" + a + "-" + rr1
                        + "T" + cc1 + ":" + ff1 + ":00");
                    $("#endday").val(testtime2.getFullYear() + "-" + gg2 + "-" + aa2
                        + "T" + dd2 + ":" + mm2 + ":00");
                    $("#applicationday").val(testtime3.getFullYear() + "-" + kk3 + "-" + bb3
                        + "T" + ee3 + ":" + ll3 + ":00");
                    $("#askfortime").val(getdata.請假時數);
                    $("#agent").val(getdata.代理人);
                    $("#approvalStatus").val(getdata.審核狀態);
                    $(".showPic").attr("src", getdata.圖片);

                }
            })
        }
        //======================================= 刪除 =======================================
        function Fdelete() {
            if (true) {
                $.ajax({
                    url: "/DDDDD/DeleteData",
                    data: { "id": $(event.currentTarget).data("id") },
                    success: function (result) {
                        swal({
                            title: "刪除?",
                            text: "確定要刪除嗎?",
                            icon: 'warning',
                            buttons: true,
                            dangerMode: true,
                        }).then((confirm) => {
                            if (confirm) {
                                swal('刪除', '刪除成功！...', 'success');
                                ReFresh();
                            } else {
                                swal('刪除', '刪除失敗!...', 'error');
                            }
                        })

                    }
                })
            }
        }

        //======================================= 刷新 =======================================
        function ReFresh() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/AskForListAjax",
                    type: "GET",
                    success: function (memberlist) {
                        $("#head總表").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>職稱</th>
                                                        <th>部門</th>
                                                        <th>請假班別</th>
                                                        <th>假別</th>
                                                        <th>申請日期</th>
                                                        <th>請假時數</th>
                                                        <th>代理人</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                        </tr>`
                        );
                        let a = " ";
                        $(memberlist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);
                            var 申請日期 = parseInt(item.申請日期.replace(/\D/igm, ""));
                            var testtime3 = new Date(申請日期);

                            if (testtime3.getHours() < 10) {
                                h3 = "0" + testtime3.getHours();
                            } else {
                                h3 = testtime3.getHours();
                            }
                            if (testtime3.getMinutes() < 10) {
                                var a3 = "0" + testtime3.getMinutes()
                            } else {
                                a3 = testtime3.getMinutes();
                            }


                            a += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.職稱}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${item.請假班別}</td>
                                                            <td>${item.假別1}</td>
                                                            <td>${testtime3.getFullYear() + "/" + (testtime3.getMonth() + 1) + "/" + testtime3.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.請假時數}</td>
                                                            <td>${item.代理人}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-toggle="modal" data-id ="${item.申請表編號}" data-target="#請假彈出" onclick="UpdateGetData請假(),modelshow()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="Fdelete()" data-id="${item.申請表編號}"><span>刪除</span></a></td></tr>`
                            $("#AskForListTbody").html(a);
                        })
                    },
                });
            }
            else {
                $.ajax({
                    url: "/DDDDD/AskForListAjax",
                    type: "GET",
                    success: function (memberlist) {
                        $("#head總表").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>職稱</th>
                                                        <th>部門</th>
                                                        <th>請假班別</th>
                                                        <th>假別</th>
                                                        <th>申請日期</th>
                                                        <th>請假時數</th>
                                                        <th>代理人</th>
                                                        <th>審核狀態</th>
                                                        </tr>`
                        );
                        let a = " ";
                        $(memberlist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);
                            var 申請日期 = parseInt(item.申請日期.replace(/\D/igm, ""));
                            var testtime3 = new Date(申請日期);

                            if (testtime3.getHours() < 10) {
                                h3 = "0" + testtime3.getHours();
                            } else {
                                h3 = testtime3.getHours();
                            }
                            if (testtime3.getMinutes() < 10) {
                                var a3 = "0" + testtime3.getMinutes()
                            } else {
                                a3 = testtime3.getMinutes();
                            }


                            a += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.職稱}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${item.請假班別}</td>
                                                            <td>${item.假別1}</td>
                                                            <td>${testtime3.getFullYear() + "/" + (testtime3.getMonth() + 1) + "/" + testtime3.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.請假時數}</td>
                                                            <td>${item.代理人}</td>
                                                            <td>${item.審核狀態}</td></tr>`
                            $("#AskForListTbody").html(a);
                        })
                    },
                });
            }
        };




        //==================================================加班部分===========================================================
        function modelshow加班() {
            $('#加班彈出').modal('toggle');
        }


        //=============================================新增=====================================================
        function AddOverTime() {
            console.log(123);
            console.log($("#加班ID2").children(":checked").val());
            $.ajax({
                url: "/DDDDD/OverTimeAjax",
                type: "POST",
                data: {
                    "EmployeeID": $("#加班EmployeeID").val(),
                    "中文姓名": $("#加班中文姓名").val(),
                    "部門": $("#加班department").val(),
                    "開始日期": $("#加班startday").val(),
                    "結束日期": $("#加班endday").val(),
                    "請假時數": $("#加班askfortime").val(),
                    "加班時數": $("#加班時數2").val(),
                    "加班ID": $("#加班ID2").children(":checked").val(),
                    "事由說明": $("#加班事由說明").val(),
                    "審核狀態": $("#加班審核狀態").val(),
                },
                success: function (result) {
                    if (result != null) {
                        setTimeout(function () {
                            //window.location.href = "/DDDDD/OverTimeList";
                            $("[data-tab='second/b']").not(".tab").click();
                        }, 2000);
                        ReFresh加班();
                        swal("成功", "新增成功", "success");
                    }
                }
            })
        }

        function 加班Demo() {
            $("#加班EmployeeID").val("2"),
                $("#加班中文姓名").val("胡冠安"),
                $("#加班department").val("資訊部"),
                $("#加班startday").val("2021-03-23T09:00:00"),
                $("#加班endday").val("2021-03-23T17:00:00"),
                $("#加班時數2").val("2"),
                $("#加班ID2").children(":checked").val(2),
                $("#加班事由說明").val("工作太多做不完"),
                $("#加班審核狀態").val("未審核")
        }

        //======================================= 總表顯示 =======================================

        let 加班getID;

        $(function () {
            getOverTimeList();
        })

        function getOverTimeList() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/OverTimeListAjax",
                    type: "GET",
                    success: function (overtimelist) {
                        $("#head加班").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>加班時數</th>
                                                        <th>加班類別</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                    </tr>`
                        );
                        $(overtimelist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            $("#OverTimeListTbody").append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.加班時數}</td>
                                                            <td>${item.加班類別}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-toggle="modal" data-id ="${item.加班表編號}" data-target="#加班彈出" onclick="UpdateGetData(),modelshow加班()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="Odelete()" data-id="${item.加班表編號}"><span>刪除</span></a></td></tr>`

                            );
                        })
                    },
                });
            }
            else {
                $.ajax({
                    url: "/DDDDD/OverTimeListAjax",
                    type: "GET",
                    success: function (overtimelist) {
                        $("#head加班").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>加班時數</th>
                                                        <th>加班類別</th>
                                                        <th>審核狀態</th>
                                                        </tr>`
                        );
                        $(overtimelist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            $("#OverTimeListTbody").append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.加班時數}</td>
                                                            <td>${item.加班類別}</td>
                                                            <td>${item.審核狀態}</td>
                                                </tr>`
                            );
                        })
                    },
                });
            }
        };
        //======================================= 刪除 =======================================
        function Odelete() {
            if (true) {
                $.ajax({
                    url: "/DDDDD/DeleteOverTimeData",
                    data: { "id": $(event.currentTarget).data("id") },
                    success: function (result) {
                        swal({
                            title: "刪除?",
                            text: "確定要刪除嗎?",
                            icon: 'warning',
                            buttons: true,
                            dangerMode: true,
                        }).then((confirm) => {
                            if (confirm) {
                                swal('刪除', '刪除成功！...', 'success');
                                ReFresh加班();
                            } else {
                                swal('刪除', '刪除失敗!...', 'error');
                            }
                        })

                    }
                })
            }
        }
        //======================================= 修改 =======================================
        function Update() {
            console.log(typeof 加班getID);
            console.log($("#加班總表加班ID").val());
            if (true) {
                $.ajax({
                    url: "/DDDDD/OverTimeUpdateAjax",
                    type: "POST",
                    data: {
                        "加班表編號": 加班getID,
                        "EmployeeID": parseInt($("#加班總表EmployeeID").val()),
                        "中文姓名": $("#加班總表中文姓名").val(),
                        "部門": $("#加班總表department").val(),
                        "開始日期": $("#加班總表startday").val(),
                        "結束日期": $("#加班總表endday").val(),
                        "加班時數": $("#加班總表加班時數").val(),
                        "加班ID": $("#加班總表加班ID").children(":checked").val(),
                        "事由說明": $("#加班總表事由說明").val(),
                        "審核狀態": $("#加班approvalStatus").val()
                    },
                    success: function (result) {
                        if (result != 0) {
                            swal("成功", "修改成功", "success");
                            $('#加班彈出').modal('toggle');
                            ReFresh加班();
                        }
                    }
                })
            }
        }



        function UpdateGetData() {
            console.log($("#加班總表加班ID").val());
            加班getID = $(event.currentTarget).data("id");
            console.log($(event.currentTarget).data("id"));
            $.ajax({
                url: "/DDDDD/GetUpdateDataOverTime",
                type: "GET",
                data: { "id": $(event.currentTarget).data("id") },
                success: function (getdata) {
                    console.log($("#EmployeeID").val(getdata.EmployeeID));
                    var testtime = parseInt(getdata.開始日期.replace(/\D/igm, ""));
                    var testtime1 = new Date(testtime);
                    var 結束日期 = parseInt(getdata.結束日期.replace(/\D/igm, ""));
                    var testtime2 = new Date(結束日期);
                    if ((testtime1.getMonth() + 1) < 10) //月
                    {
                        var a = "0" + (testtime1.getMonth() + 1);  //why var
                    }
                    else {
                        a = (testtime1.getMonth() + 1);
                    }
                    if ((testtime2.getMonth() + 1) < 10) {
                        var gg2 = "0" + (testtime2.getMonth() + 1);
                    }
                    else {
                        gg2 = (testtime2.getMonth() + 1);
                    }
                    if (testtime1.getDate() < 10) //日
                    {
                        var rr1 = "0" + (testtime1.getDate());
                    }
                    else {
                        rr1 = testtime1.getDate();
                    }
                    if (testtime2.getDate() < 10) {
                        var aa2 = "0" + (testtime2.getDate());
                    }
                    else {
                        aa2 = testtime2.getDate();
                    }
                    if (testtime1.getHours() < 10) //時
                    {
                        var cc1 = "0" + testtime1.getHours();
                    }
                    else {
                        cc1 = testtime1.getHours();
                    }
                    if (testtime2.getHours() < 10) {
                        var dd2 = "0" + testtime2.getHours();
                    }
                    else {
                        dd2 = testtime2.getHours();
                    }
                    if (testtime1.getMinutes() < 10)  //分
                    {
                        var ff1 = "0" + testtime1.getMinutes();
                    }
                    else {
                        ff1 = testtime1.getMinutes();
                    }
                    if (testtime1.getMinutes() < 10) {
                        var mm2 = "0" + testtime1.getMinutes();
                    }
                    else {
                        mm2 = testtime1.getMinutes();
                    }
                    $("#加班表編號").val(getdata.加班表編號);
                    $("#加班總表EmployeeID").val(getdata.EmployeeID);
                    $("#加班總表中文姓名").val(getdata.中文姓名);
                    $("#加班總表department").val(getdata.部門);
                    $("#加班總表startday").val(testtime1.getFullYear() + "-" + a + "-" + rr1
                        + "T" + cc1 + ":" + ff1 + ":00");
                    $("#加班總表endday").val(testtime2.getFullYear() + "-" + gg2 + "-" + aa2
                        + "T" + dd2 + ":" + mm2 + ":00");
                    $("#加班總表加班ID").find(`input[value='${getdata.加班ID}']`).prop("checked", true); //找出input底下有value這個屬性並且值等於加班ID的標籤設定checked屬性
                    $("#加班總表加班時數").val(getdata.加班時數);
                    $("#加班總表事由說明").val(getdata.事由說明);
                    $("#加班approvalStatus").val(getdata.審核狀態)
                }
            })
        }

        //======================================= 刷新 =======================================
        function ReFresh加班() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/OverTimeListAjax",
                    type: "GET",
                    success: function (overtimelist) {
                        $("#head加班").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>加班時數</th>
                                                        <th>加班類別</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                        </tr>`
                        );
                        let b = " ";
                        $(overtimelist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }

                            b += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.加班時數}</td>
                                                            <td>${item.加班類別}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-toggle="modal" data-id ="${item.加班表編號}" data-target="#加班彈出" onclick="UpdateGetData(),modelshow加班()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="Odelete()" data-id="${item.加班表編號}"><span>刪除</span></a></td></tr>`
                            $("#OverTimeListTbody").html(b);
                        })
                    },
                });
            }
            else {
                $.ajax({
                    url: "/DDDDD/OverTimeListAjax",
                    type: "GET",
                    success: function (overtimelist) {
                        $("#head加班").html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>中文姓名</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>加班時數</th>
                                                        <th>加班類別</th>
                                                        <th>審核狀態</th>
                                                     </tr>`
                        );
                        let b = " ";
                        $(overtimelist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }

                            b += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.加班時數}</td>
                                                            <td>${item.加班類別}</td>
                                                            <td>${item.審核狀態}</td>
                                                          </tr>`
                            $("#OverTimeListTbody").html(b);
                        })
                    },
                });
            }
        };

        //======================================= 出差 =======================================================================================

        function modelshow出差() {
            $('#出差彈出').modal('toggle');
        }
        //======================================= 新增 =======================================
        function AddBusinessTripAjax() {
            console.log(123);
            $.ajax({
                url: "/DDDDD/BusinessTripAjax",
                type: "POST",
                data: {
                    "EmployeeID": $("#出差EmployeeID").val(),
                    "中文姓名": $("#出差中文姓名").val(),
                    "部門": $("#出差部門").val(),
                    "出差類型": $("#出差出差類型").val(),
                    "出差地點": $("#出差出差地點").val(),
                    "開始日期": $("#出差開始日期").val(),
                    "結束日期": $("#出差結束日期").val(),
                    "交通需求": $("#出差交通需求").val(),
                    "住宿需求": $("#出差住宿需求").val(),
                    "預支費用": $("#出差預支費用").val(),
                    "備註": $("#出差備註").val(),
                    "審核狀態": $("#出差審核狀態").val(),
                },
                success: function (result) {
                    if (result != null) {
                        setTimeout(function () {
                            //window.location.href = "/DDDDD/BusinessTripList";
                            $("[data-tab='third/b']").not(".tab").click();
                        }, 2000);
                        ReFresh出差();
                        swal("成功", "新增成功", "success");
                    }
                }
            })
        }


        function 出差Demo() {
            $("#出差EmployeeID").val("3");
            $("#出差中文姓名").val("Yuan");
            $("#出差部門").val("資訊部");
            $("#出差出差類型").dropdown('set selected', '國內');
            $("#出差出差地點").val("Taipei");
            $("#出差開始日期").val("2021-03-23T09:00:00");
            $("#出差結束日期").val("2021-03-23T17:00:00");
            $("#出差交通需求").dropdown('set selected', '高鐵票');
            $("#出差預支費用").val("5000");
            $("#出差住宿需求").dropdown('set selected', '國內住宿');
            $("#出差備註").val("出差好辛苦");
            $("#出差審核狀態").val("未審核")
        };



        //======================================= 總表顯示 =======================================
        GetBusinessTripList();
        function GetBusinessTripList() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/BusinessTripListAjax",
                    type: "GET",
                    success: function (mylist) {
                        $('#head').html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>申請人</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                    </tr>`
                        )
                        $(mylist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            $('#BusinessTripListTbody').append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-toggle="modal" data-id ="${item.出差表編號}" data-target="#出差彈出" onclick="GetUpdataBusiness(),modelshow出差()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="businessdelete()" data-id="${item.出差表編號}"><span>刪除</span></a></td>
                                                        </tr>`
                            )
                        }
                        )

                    }
                })
            }
            else {
                $.ajax({
                    url: "/DDDDD/BusinessTripListAjax",
                    type: "GET",
                    success: function (mylist) {
                        $('#head').html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>申請人</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>審核狀態</th>
                                                    </tr>`
                        )
                        $(mylist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }


                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            $('#BusinessTripListTbody').append(
                                `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.審核狀態}</td>
                                                        </tr>`
                            )
                        }
                        )

                    }
                })
            }
        }


        //======================================= 刪除 =======================================

        function businessdelete() {
            console.log(123);
            console.log($(event.currentTarget).data("id"));
            $.ajax({
                url: "/DDDDD/DeleteBusinessTrip",
                data: { "id": $(event.currentTarget).data("id") },
                success: function (result) {
                    swal({
                        title: "刪除?",
                        text: "確定要刪除嗎?",
                        icon: 'warning',
                        buttons: true,
                        dangerMode: true,
                    }).then((confirm) => {
                        if (confirm) {
                            swal('刪除', '刪除成功！...', 'success');
                            ReFresh出差();
                        } else {
                            swal('刪除', '刪除失敗!...', 'error');
                        }
                    })
                }
            })
        }

        //======================================= 修改 =======================================

        let SwagID;
        function UpdateBusiness() {
            console.log(event.currentTarget);
            $.ajax({
                url: "/DDDDD/UpdateBusinessTripAjax",
                type: "POST",
                data: {
                    "出差表編號": SwagID,
                    "EmployeeID": $("#出差總表EmployeeID").val(),
                    "中文姓名": $("#出差總表中文姓名").val(),
                    "部門": $("#出差總表部門").val(),
                    "出差類型": $("#出差總表出差類型").val(),
                    "出差地點": $("#出差總表出差地點").val(),
                    "開始日期": $("#出差總表開始日期").val(),
                    "結束日期": $("#出差總表結束日期").val(),
                    "交通需求": $("#出差總表交通需求").val(),
                    "住宿需求": $("#出差總表住宿需求").val(),
                    "預支費用": $("#出差總表預支費用").val(),
                    "備註": $("#出差總表備註").val(),
                    "審核狀態": $("#出差approvalStatus").val()
                },
                success: function (result) {
                    if (result != 0) {
                        swal("成功", "修改成功", "success");
                        $('#出差彈出').modal('toggle');
                        ReFresh出差();
                    }

                }
            })
        }



        function GetUpdataBusiness() {
            SwagID = $(event.currentTarget).data("id");
            console.log(event.currentTarget);
            console.log(SwagID);
            console.log(132);
            $.ajax({
                url: "/DDDDD/GetUpdateBusinessTripAjax",
                type: "GET",
                data: { "id": $(event.currentTarget).data("id") },
                success: function (getdata) {
                    console.log($("#出差總表EmployeeID").val(getdata.EmployeeID));
                    var 開始日期 = parseInt(getdata.開始日期.replace(/\D/igm, ""));
                    var testtime1 = new Date(開始日期);
                    var 結束日期 = parseInt(getdata.結束日期.replace(/\D/igm, ""));
                    var testtime2 = new Date(結束日期);
                    if ((testtime1.getMonth() + 1) < 10) //月
                    {
                        var a = "0" + (testtime1.getMonth() + 1);  //why var
                    }
                    else {
                        a = (testtime1.getMonth() + 1);
                    }
                    if ((testtime2.getMonth() + 1) < 10) {
                        var gg2 = "0" + (testtime2.getMonth() + 1);
                    }
                    else {
                        gg2 = (testtime2.getMonth() + 1);
                    }
                    if (testtime1.getDate() < 10) //日
                    {
                        var rr1 = "0" + (testtime1.getDate());
                    }
                    else {
                        rr1 = testtime1.getDate();
                    }
                    if (testtime2.getDate() < 10) {
                        var aa2 = "0" + (testtime2.getDate());
                    }
                    else {
                        aa2 = testtime2.getDate();
                    }
                    if (testtime1.getHours() < 10) //時
                    {
                        var cc1 = "0" + testtime1.getHours();
                    }
                    else {
                        cc1 = testtime1.getHours();
                    }
                    if (testtime2.getHours() < 10) {
                        var dd2 = "0" + testtime2.getHours();
                    }
                    else {
                        dd2 = testtime2.getHours();
                    }
                    if (testtime1.getMinutes() < 10)  //分
                    {
                        var ff1 = "0" + testtime1.getMinutes();
                    }
                    else {
                        ff1 = testtime1.getMinutes();
                    }
                    if (testtime1.getMinutes() < 10) {
                        var mm2 = "0" + testtime1.getMinutes();
                    }
                    else {
                        mm2 = testtime1.getMinutes();
                    }
                    $("#出差總表出差表編號").val(getdata.出差表編號);
                    $("#出差總表EmployeeID").val(getdata.EmployeeID);
                    $("#出差總表中文姓名").val(getdata.中文姓名);
                    $("#出差總表部門").val(getdata.部門);
                    $("#出差總表出差類型").val(getdata.出差類型);
                    $("#出差總表出差地點").val(getdata.出差地點);
                    $("#出差總表開始日期").val(testtime1.getFullYear() + "-" + a + "-" + rr1
                        + "T" + cc1 + ":" + ff1 + ":00");
                    $("#出差總表結束日期").val(testtime2.getFullYear() + "-" + gg2 + "-" + aa2
                        + "T" + dd2 + ":" + mm2 + ":00");
                    $("#出差總表交通需求").val(getdata.交通需求);
                    $("#出差總表住宿需求").val(getdata.住宿需求);
                    $("#出差總表預支費用").val(getdata.預支費用);
                    $("#出差總表備註").val(getdata.備註);
                    $("#出差approvalStatus").val(getdata.審核狀態)
                }
            })
        }

        //======================================= 刷新 =======================================
        function ReFresh出差() {
            if (decodeURI(document.cookie.split('Auth=')[1].split('&')[0]) == '主管') {
                $.ajax({
                    url: "/DDDDD/BusinessTripListAjax",
                    type: "GET",
                    success: function (mylist) {
                        $('#head').html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>申請人</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>審核狀態</th>
                                                        <th>詳細</th>
                                                        <th>刪除</th>
                                                    </tr>`
                        )
                        let c = " ";
                        $(mylist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }
                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            c += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.審核狀態}</td>
                                                            <td><a class="btn btn-outline-primary button btnDetail" data-toggle="modal" data-id ="${item.出差表編號}" data-target="#出差彈出" onclick="GetUpdataBusiness(),modelshow出差()"><span>詳細</span></a></td>
                                                            <td><a class="btn btn-outline-danger button"  onclick="businessdelete()" data-id="${item.出差表編號}"><span>刪除</span></a></td>
                                                        </tr>`
                            $("#BusinessTripListTbody").html(c);
                        }
                        )

                    }
                })
            }
            else {
                $.ajax({
                    url: "/DDDDD/BusinessTripListAjax",
                    type: "GET",
                    success: function (mylist) {
                        $('#head').html(
                            `<tr>
                                                        <th>員工編號</th>
                                                        <th>申請人</th>
                                                        <th>部門</th>
                                                        <th>開始日期</th>
                                                        <th>結束日期</th>
                                                        <th>審核狀態</th>
                                                    </tr>`
                        )
                        let c = " ";
                        $(mylist).each(function (index, item) {
                            var testtime = parseInt(item.開始日期.replace(/\D/igm, ""));
                            var testtime1 = new Date(testtime);
                            var 結束日期 = parseInt(item.結束日期.replace(/\D/igm, ""));
                            var testtime2 = new Date(結束日期);

                            if (testtime1.getHours() < 10) {
                                h2 = "0" + testtime1.getHours();
                            } else {
                                h2 = testtime1.getHours();
                            }
                            if (testtime1.getMinutes() < 10) {
                                var a2 = "0" + testtime1.getMinutes()
                            } else {
                                a2 = testtime1.getMinutes();
                            }
                            if (testtime2.getHours() < 10) {
                                h3 = "0" + testtime2.getHours();
                            } else {
                                h3 = testtime2.getHours();
                            }
                            if (testtime2.getMinutes() < 10) {
                                var a3 = "0" + testtime2.getMinutes()
                            } else {
                                a3 = testtime2.getMinutes();
                            }
                            c += `<tr>
                                                            <td>${item.EmployeeID}</td>
                                                            <td>${item.中文姓名}</td>
                                                            <td>${item.部門}</td>
                                                            <td>${testtime1.getFullYear() + "/" + (testtime1.getMonth() + 1) + "/" + testtime1.getDate() + " " + h2 + ":" + a2}</td>
                                                            <td>${testtime2.getFullYear() + "/" + (testtime2.getMonth() + 1) + "/" + testtime2.getDate() + " " + h3 + ":" + a3}</td>
                                                            <td>${item.審核狀態}</td>
                                                        </tr>`
                            $("#BusinessTripListTbody").html(c);
                        }
                        )

                    }
                })
            }
        }
    </script>
}


